<% @molecule = @library_entry.sample.molecule %>

<% sample = @library_entry.sample %>

<% if params[:project_id].nil? then %>

          <% @projid = current_user.rootproject_id.to_s %>

          <% else %>

          <% if params[:project_id].empty? then @projid = current_user.rootproject_id.to_s else %>
        
          <% @projid = params[:project_id] %>

          <% end %>

          <% end %>


<% @project = Project.find(@projid) %>

<% @projects = @sample.projects %>

<% @showsidebar = true %>

<% content_for :sidebar_switch do @showsidebar = true end %>

<% content_for :sidebar do %>

 <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
          
  <div class="panel panel-default">

        <div class="panel-heading">
          <h3 class="panel-title">Project visibility<% if sample.reactions.first.nil? then %>&nbsp;<%= link_to "Change", assign_sample_path, :class => "btn btn-xs btn-success" %><% end %></h3>
        </div>

        <div class="panel-body">


      <% current_user.topprojects.each do |p| %>

              <ul class="nav nav-pills nav-stacked">

                <%= render 'layouts/projecttree', :highlight => @projects, :p => p, :project_id => -1, :category => "samples", :level => 0 %>


          </ul>

      <% end %>


            
          </div>
        </div>
    </div>
</div>
  
<% end %>



<% content_for :sidenav_switch do @shownavbar = true end %>

<% content_for :sidenav do %>

    <div class="navbar navbar-fixed-left col-xs-12 col-sm-2 col-md-2 bs-sidebar">


                <% if params[:project_id].nil? then %>

          <% @projid = current_user.rootproject_id.to_s %>

          <% else %>

          <% if params[:project_id].empty? then @projid = current_user.rootproject_id.to_s else %>
        
          <% @projid = params[:project_id] %>

          <% end %>

          <% end %>

      <div class="well">

        <% @currentitem = "samples" %>

        <%= render 'layouts/moleculesmenu', :category => "samples", :project_id => @projid %>

      </div>


        <%= render 'layouts/projectsmenu', :category => "samples", :project_id => @projid %>



    </div>
  
<% end %>

<% @shownavbar = true %>



<h1>
  <span class="glyphicon glyphicon-glass" /><%=  sample.longname %>
</h1>

<h3><%= sample.target_amount.to_s+" "+sample.unit %>  <small> (<%= sample.actual_amount.to_s+" "+sample.unit %>) </small></h3>


      <% if !sample.reactions.first.nil? then %><br><% sample.reactions.each do |r| %><em> <%= sample.role %> in </em> <%= link_to reaction_path(r, :project_id => @projid) do %><span class="glyphicon glyphicon-flash" /><%= r.name %><% end %><% end %><% end %>



    <td><%= link_to split_sample_path(sample, :project_id => @projid), :class => "btn btn-xs btn-default" do %><span class="glyphicon glyphicon-tint"> Split</span><% end %><br/>
      <%= link_to transfer_sample_path(sample, :project_id => @projid), :class => "btn btn-xs btn-default" do %><span class="glyphicon glyphicon-send"> Transfer</span><% end %></td>

<table style="border-spacing: 10px; border-collapse: separate;">
  <tr>

    <td>

<%= render "molecules/render", :molecule => @molecule, :width => "200", :height => "150" %>

</td>

<td>Molecule: <%= link_to @molecule.title, molecule_path(@molecule, :project_id => @projid) %></td>


</tr>

</table>

<h3><span class="glyphicon glyphicon-paperclip"/> <%= sample.datasets.length %> Datasets<%= link_to 'Add Dataset', create_direct_datasets_path(:sample_id => sample.id, :project_id => @projid), :class => "btn btn-default btn-sm" %></h3>


<%= render 'library_entries/datasets', :id => sample.id, :sample => sample, :molecule => @molecule %>