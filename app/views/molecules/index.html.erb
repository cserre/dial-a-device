<% content_for :sidenav_switch do @shownavbar = true end %>

<% content_for :sidenav do %>

    <div class="navbar navbar-fixed-left col-xs-12 col-sm-2 col-md-2 bs-sidebar">

      <div class="well">

        <% @currentitem = "molecules" %>

        <%= render 'layouts/moleculesmenu' %>

      </div>
    </div>
  
<% end %>

<% @shownavbar = true %>

<%= @output %>

<% if @filter then %>

<div class="alert alert-info">
<p>This molecule list is filtered.&nbsp;<a class="btn btn-primary btn-xs" href="/molecules">Remove filter</a></p>
</div>

<% else %>

<div class="alert alert-info">

<p>All molecules are displayed.&nbsp;<a class="btn btn-primary btn-xs" data-toggle="collapse" data-target="#searchwindow" href="#">Filter...</a></p>


<div id="searchwindow" class="collapse" role="collapse">

        <script type="text/javascript" src="/assets/ChemDoodleWeb/sketcher/ChemDoodleWeb-sketcher.js"></script>

          <canvas id="sketcher_search" onclick="updatemoleculesearch();" >

          
          </canvas>

          <script type="text/javascript">


            var sketcher = new ChemDoodle.SketcherCanvas('sketcher_search', 600, 200, {useServices: false, oneMolecule: true, isMobile: true});


            function updatemoleculesearch() {
                mol = sketcher.getMolecule();

                document.getElementById("search_molfile").value = ( ChemDoodle.writeMOL(mol));

            }

        </script>


          

          <form id="moldetailform" action="/molecules/filter" method="get">

            <textarea id="search_molfile" name="molfile" rows="50" cols="300" style="display:none;">temporary molfile</textarea>

            <button type="submit" class="btn btn-primary" onclick="">Structure Search &raquo;</button>
            

          </form>

          <br/>

          <form id="moldetailform" action="/molecules/filter" method="get">

            <p>Molecule name:&nbsp;
            <input type="text" id="search_molfile" name="title" rows="1" cols="30"></input>&nbsp; <button type="submit" class="btn btn-primary" onclick="">Name Search &raquo;</button></p>

            
            

          </form>


        </div>

  </div>

<% end %>

<% if !current_user.nil? then %>

<% current_user.projects.each do |project| %>

<h1><% if project.title.nil? then %>My Molecules<% else %>Molecules in <%= project.title %><% end %>&nbsp;
<%= link_to 'New Molecule', new_molecule_path(:assign_to_project_id => project.id), :class => "btn btn-sm btn-success" %></h1>

<% projectmolecules = @molecules.where(["project_memberships.project_id = ?", project.id]) %>
<% if projectmolecules.length > 0 then %>
<table>
    
<% projectmolecules.each do |molecule| %>
  <tr>
    <td>
      


    <%= render "molecules/render", :molecule => @molecule, :width => "50", :height => "50" %>


    </td>

    <td><%= link_to molecule do %><%= molecule.title %><% end %></td>
  </tr>
<% end %>
</table>

<% else %>

<p>No molecules found.</p>

<% end %>

<% end %>

<% end %>

<br/>


<br/>
